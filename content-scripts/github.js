/* global browser */

const linkElement = document.getElementById('user-links').querySelector('a.notification-indicator');
const octiconBell = linkElement.getElementsByTagName("svg")[0]
const unreadStatus = linkElement.getElementsByTagName("span")[0]

const infinicle = '<svg height="16" viewBox="0 0 30 16" width="30" xmlns="http://www.w3.org/2000/svg"><g fill="#fff"><path d="m16.5708527 6.44822836c2.0330225-2.54251267 4.3012633-3.87850957 6.8047224-4.00799071 2.5002489 0 5.9502403 1.63011192 5.9502403 5.70657943 0 3.83817492-2.0059852 7.85318292-7.4458626 7.85318292-2.9101319 0-5.7638701-1.7686199-7.4779765-3.4834935-3.7366886-3.73836074-5.42349905-9.16442821-8.73987074-9.16442821-2.11801705 0-3.72756793.80824536-4.82865264 2.42473607 1.25928092-3.18898826 3.54167295-4.94940221 6.84717609-5.28124183 3.74823109-.20778302 5.74083329 2.72612558 9.01937099 6.08768219 3.2785377 3.3615566 7.5197583 4.46597178 7.5197583 1.75983966 0-2.80331321-4.5506089-.94764558-5.4184713 0-.6614622-.43046266-1.4049404-1.06208467-2.2304343-1.89486602z"/><path d="m1.50486373 5.89673166c1.31002359 0 1.07998285 1.91213941-.23004073 1.91213941-1.31002359 0-1.07998285-1.91213941.23004073-1.91213941z"/><path d="m4.43490836 6.94339623c1.39052673 0 .92357663 2.14187875-.4669501 2.14187875s-.92357663-2.14187875.4669501-2.14187875z"/><path d="m3.50424864 4.28679245c1.31002359 0 1.10834765 1.71200265-.20167593 1.71200265-1.31002359 0-1.10834765-1.71200265.20167593-1.71200265z"/><path d="m17.0853078 3.80377358c.8396344 0 0 1.46894839-1.0970488 1.46894839-1.0970487 0 .2574144-1.46894839 1.0970488-1.46894839z"/><path d="m15.5721002 2.64866641c.5904335 0-.6979183 1.14915922-1.2007017 1.14915922-.5027833 0 .6102683-1.14915922 1.2007017-1.14915922z"/><path d="m18.1180088.66415094c.7889906 0-1.1070504 1.22360943-2.0646314 1.22360943s1.2756408-1.22360943 2.0646314-1.22360943z"/><path d="m19.3431499 1.87727564c.987036 0-.5928309 1.58950497-1.5798669 1.58950497s.592831-1.58950497 1.5798669-1.58950497z"/><path d="m20.8688995 0c1.3100236 0-.4386073.75611785-1.7486309.75611785-1.3100235 0 .4386073-.75611785 1.7486309-.75611785z"/><path d="m21.9593135.9097023c1.3100236 0 .0193671.78382241-1.2906565.78382241s-.0193671-.78382241 1.2906565-.78382241z"/><path d="m22.5901213.13994352c1.3100236 0 1.9571628.5.6471392.5s-1.9571628-.5-.6471392-.5z"/><path d="m24.352356.78490566c1.3100236 0 2.412488.83759103 1.2834429.83759103s-2.5934665-.83759103-1.2834429-.83759103z"/><path d="m26.5864708 1.72125147c.3854509 0 1.57414 1.64300296 1.1130516 1.64300296-.4610885 0-1.4985026-1.64300296-1.1130516-1.64300296z"/><path d="m6.24534919 5.49433962c1.31002359 0 1.1745134 1.67763856-.13551019 1.67763856-1.31002358 0-1.17451339-1.67763856.13551019-1.67763856z"/><path d="m5.96947416 3.86890867c1.31002359 0 1.15562587 1.09122077-.15439772 1.09122077-1.31002358 0-1.15562586-1.09122077.15439772-1.09122077z"/><path d="m7.56204229 5.07471428c.7337976 0 1.94469132.93618482 1.4914683.93618482-.45322303 0-2.2252659-.93618482-1.4914683-.93618482z"/><path d="m10.7412184 8.45304661c1.3348455 0 .2977097 1.98665819-.9348381 1.98665819-1.23254783 0-.39281251-1.98665819.9348381-1.98665819z"/><path d="m1.44173063 12.4377358c.67174517 0 2.73708791 2.3432099 1.6121995 2.3432099-1.12488842 0-2.28394467-2.3432099-1.6121995-2.3432099z"/><path d="m.64068343 8.57380133c.96166844 0 1.22828243 3.21899037.24902262 3.21899037-.9792598 0-1.21069107-3.21899037-.24902262-3.21899037z"/><path d="m3.18549747 9.35849057c1.05204875 0 1.37352679 2.33332723.20588059 2.33332723s-1.25792933-2.33332723-.20588059-2.33332723z"/><path d="m4.68169342 12.0150943c1.51072972 0 2.48306885 1.4689484.97233912 1.4689484-1.51072972 0-2.48306884-1.4689484-.97233912-1.4689484z"/><path d="m4.35460316 14.8844737c1.35531644-.3375175 3.97536361.3377045 2.66534002.6679253-1.31002358.3302208-4.02065646-.3304079-2.66534002-.6679253z"/><path d="m10.1184274 13.3100899c.7696447 0-1.02752725 1.6440472-1.97108935 1.6440472-.75045984 0 1.06488072-1.6440472 1.97108935-1.6440472z"/><path d="m8.88318024 10.9283019c1.31002356 0 .09761411 1.8931909-1.21240948 1.8931909-1.31002358 0-.09761411-1.8931909 1.21240948-1.8931909z"/><path d="m12.2697836 10.8679245c1.0267335 0-.4195086 1.9758755-1.3718419 1.9758755-.95233327 0 .3451084-1.9758755 1.3718419-1.9758755z"/></g></svg>'

const infinicleContainer = document.createElement("div")
infinicleContainer.innerHTML = infinicle

const infinicleSVG = infinicleContainer.getElementsByTagName("svg")[0]
infinicleSVG.style.verticalAlign = "text-bottom"
infinicleSVG.style.fill = "currentColor"
infinicleSVG.style.display = "inline-block"

function applyOptions(options) {
	linkElement.href = options.octoboxUrl || 'https://octobox.io';
	linkElement.title = 'Open Octobox';
	unreadStatus.style.left = "20px"
	octiconBell.style.display = "none"

	linkElement.appendChild(infinicleContainer.getElementsByTagName("svg")[0])
}

const options = browser.storage.local.get();
options.then(applyOptions, console.error);
